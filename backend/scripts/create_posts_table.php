<?php
/**
 * T·∫°o b·∫£ng posts ƒë·ªÉ l∆∞u tin t·ª©c/b√†i vi·∫øt
 */

require_once __DIR__ . '/../inc/db.php';

try {
    $pdo = getPDO();
    
    echo "<h2>üîß T·∫°o B·∫£ng Posts</h2>";
    echo "<style>body{font-family:Arial;padding:20px;background:#f5f5f5;} .success{color:green;font-weight:bold;} .error{color:red;font-weight:bold;}</style>";
    
    echo "<p>ƒêang t·∫°o b·∫£ng posts...</p>";
    
    // T·∫°o b·∫£ng posts
    $sql = "CREATE TABLE IF NOT EXISTS posts (
        id INT AUTO_INCREMENT PRIMARY KEY,
        title VARCHAR(255) NOT NULL,
        slug VARCHAR(255) UNIQUE NOT NULL,
        excerpt TEXT,
        content LONGTEXT,
        featured_image VARCHAR(500),
        author_id INT DEFAULT NULL,
        category VARCHAR(100),
        tags VARCHAR(255),
        status ENUM('draft', 'published', 'archived') DEFAULT 'draft',
        views INT DEFAULT 0,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        published_at DATETIME DEFAULT NULL,
        INDEX idx_status (status),
        INDEX idx_category (category),
        INDEX idx_created_at (created_at),
        INDEX idx_slug (slug)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci";
    
    $pdo->exec($sql);
    echo "<p class='success'>‚úì B·∫£ng posts ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!</p>";
    
    // Ki·ªÉm tra c·∫•u tr√∫c b·∫£ng
    $columns = $pdo->query("SHOW COLUMNS FROM posts")->fetchAll(PDO::FETCH_ASSOC);
    
    echo "<h3>üìã C·∫•u tr√∫c b·∫£ng posts:</h3>";
    echo "<table border='1' cellpadding='8' style='border-collapse:collapse;background:white;'>";
    echo "<tr style='background:#38bdf8;color:white;'><th>Field</th><th>Type</th><th>Null</th><th>Key</th><th>Default</th></tr>";
    foreach ($columns as $col) {
        echo "<tr>";
        echo "<td><strong>" . htmlspecialchars($col['Field']) . "</strong></td>";
        echo "<td>" . htmlspecialchars($col['Type']) . "</td>";
        echo "<td>" . htmlspecialchars($col['Null']) . "</td>";
        echo "<td>" . htmlspecialchars($col['Key']) . "</td>";
        echo "<td>" . htmlspecialchars($col['Default']) . "</td>";
        echo "</tr>";
    }
    echo "</table>";
    
    echo "<hr>";
    echo "<h3 class='success'>‚úÖ Ho√†n t·∫•t!</h3>";
    echo "<p>B√¢y gi·ªù b·∫°n c√≥ th·ªÉ th√™m b√†i vi·∫øt.</p>";
    
    echo "<p style='text-align:center;margin-top:30px;'>";
    echo "<a href='add_more_posts.php' style='display:inline-block;padding:15px 30px;background:#38bdf8;color:white;text-decoration:none;border-radius:10px;font-weight:bold;font-size:1.1em;'>üìù Th√™m 10 B√†i Vi·∫øt Ngay</a>";
    echo "</p>";
    
} catch (Exception $e) {
    echo "<p class='error'>‚úó L·ªói: " . htmlspecialchars($e->getMessage()) . "</p>";
    exit(1);
}
?>

